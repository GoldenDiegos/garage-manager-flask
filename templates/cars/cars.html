{% extends "base.html" %}

{% block content %}

<header class="card">
  <h2>Automóviles</h2>
  <a class="btn btn-edit" href="/view/cars/create">+ Agregar Carro</a>
</header>

<section class="card" id="cars-container">
  <p>Cargando autos...</p>
</section>

<script>
async function loadCars() {
  const res = await fetch("/cars");
  const cars = await res.json();

  const container = document.getElementById("cars-container");

  if (!cars.length) {
    container.innerHTML = `
      <p><b>No hay autos registrados.</b></p>
      <p>Agrega uno desde <a href="/view/cars/create">Agregar Carro</a>.</p>
    `;
    return;
  }

  let html = "";

  cars.forEach(car => {
    html += `
      <section class="card">
        <header>
          <h3>${car.brand} ${car.model} (${car.year})</h3>
        </header>

        <div class="car-info">
          <p><strong>Owner:</strong> ${car.user_name}</p>
          <p><strong>Plate:</strong> ${car.plate || "Sin placa"}</p>
        </div>

        <div class="actions">

          <a class="btn btn-primary" href="/view/cars/${car.id}/services">
            Servicios
          </a>

          <a class="btn btn-docs" href="/view/cars/${car.id}/documents">
            Documentos
          </a>

          <a class="btn btn-edit" href="/view/cars/${car.id}/edit">
            Editar
          </a>

          <button class="btn btn-danger" onclick="deleteCar(${car.id})">
            Eliminar
          </button>

        </div>
      </section>
    `;
  });

  container.innerHTML = html;
}

async function deleteCar(id) {
  if (!confirm("¿Seguro que deseas eliminar este carro?")) return;

  const res = await fetch(`/cars/${id}`, { method: "DELETE" });
  const data = await res.json();

  alert(data.message || data.error || "Listo");
  loadCars();
}

loadCars();
</script>

{% endblock %}
